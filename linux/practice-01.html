<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-05b8c18cdbe0b397.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-2043948c1246ba90.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9538641435026bd3.js" defer=""></script><script src="/_next/static/chunks/pages/linux/practice-01-cef5e28ca8ddcf5b.js" defer=""></script><script src="/_next/static/LUG9vo4cHsjOtBLj04oqM/_buildManifest.js" defer=""></script><script src="/_next/static/LUG9vo4cHsjOtBLj04oqM/_ssgManifest.js" defer=""></script></head><body><div id="__next"><h1>Установка и настройка веб-серверов</h1>
<h2>Цель работы</h2>
<p>Научиться устанавливать и настраивать веб-серверы Apache HTTPd и Nginx.</p>
<h2>План работы</h2>
<ul>
<li>Установить веб-сервер Apache HTTPd</li>
<li>Сконфигурировать два разных виртуальных хоста</li>
<li>Установить модуль PHP</li>
<li>Установить веб-сервер Nginx</li>
<li>Сконфигурировать работу PHP через интерфейс FastCGI</li>
<li>Сконфигурировать проксирование веб-сайтов</li>
</ul>
<h2>Теоретические основы</h2>
<p>Наиболее популярные веб-серверы:</p>
<ul>
<li>Apache HTTPd — гибко конфигурируется, много возможностей, не очень быстрый;</li>
<li>Nginx — нет всех возможностей Apache HTTPd, высокопроизводительный, часто используется как обратный прокси-сервер;</li>
<li>Lighttpd — высокопроизводительный, но немного уступает Nginx по скорости и возможностям;</li>
<li>Microsoft Internet Information Server — высокопроизводительный, работает только в ОС Windows, единственный вариант, если нужно разместить веб-сайт на ASP.NET, иногда имеет проблемы с безопасностью;</li>
</ul>
<p>Интерфейсы для подключения серверных скриптов:</p>
<ul>
<li>CGI (Common Gateway Interface) — использует потоки ввода / вывода, не очень быстрый, универсальный;</li>
<li>FastCGI — использует TCP-сокеты и UNIX-сокеты, эффективно кеширует серверный код, значительно быстрее CGI, универсальный;</li>
<li>SCGI (Simple CGI) — упрощенный вариант FastCGI, быстрее CGI, универсальный;</li>
<li>WSGI — специализированный интерфейс для Python;</li>
<li>PSGI — специализированный интерфейс для Perl;</li>
</ul>
<p>Обратные прокси-серверы используются для:</p>
<ul>
<li>распределение нагрузки между несколькими веб-серверами;</li>
<li>выполнения дополнительных преобразований с возвращаемым клиенту контентом (например: сжатие, TLS-шифрование и т.п.);</li>
<li>защита от внешних атак;</li>
</ul>
<h2>Подготовительный этап</h2>
<ul>
<li>
<p>Перед запуском виртуальной машины настройте её так, чтобы у нее было два сетевых адаптера:</p>
<ul>
<li>Работающий в режиме «NAT»</li>
<li>Работающий в режиме «Виртуальный адаптер хоста» (Host-only adapter)</li>
</ul>
</li>
<li>
<p>С помощью команды <code>ip address</code> убедитесь, что сетевые адаптеры получили IP-адреса:</p>
<ul>
<li>в сети 10.0.2.0/24 или 10.0.3.0/24</li>
<li>в сети 192.168.56.0/24</li>
</ul>
</li>
<li>
<p>Отредактируйте на хост-компьютере файл <code>C:\Windows\System32\Drivers\etc\hosts</code> (для редактирования нужны права администратора, пароль администратора: «имикиц428»). В этот файл нужно поместить строки вида (IP-адрес нужно заменить на тот, который получен вашей виртуальной машиной в сети 192.168.56.0/24):</p>
</li>
</ul>
<pre><code>  192.168.56.101 test1
  192.168.56.101 test2
</code></pre>
<ul>
<li>Добавьте аналогичные строки в файл <code>/etc/hosts</code> в виртуальной машине</li>
</ul>
<h2>Установка веб-сервера Apache HTTPd</h2>
<ul>
<li>Установите пакет веб-сервера Apache HTTPd:</li>
</ul>
<pre><code class="language-bash">  sudo apt get install apache2
</code></pre>
<ul>
<li>
<p>Откройте в браузере хост-компьютера адрес http://test1 и убедитесь, что веб-сервер заработал.</p>
</li>
<li>
<p>Установите модуль для работы Apache HTTPd с PHP:</p>
</li>
</ul>
<pre><code class="language-bash">    sudo apt install libapache2-mod-php
</code></pre>
<ul>
<li>Создайте каталог www в домашней каталоге и поместите в него файл <code>index.php</code> следующего
вида:</li>
</ul>
<pre><code>  &lt;?php
      phpinfo();
  ?&gt;
</code></pre>
<ul>
<li>Создайте файл <code>/etc/apache2/sites-available/test2.conf</code> (сделайте соответствующую замену):</li>
</ul>
<pre><code>  &lt;VirtualHost *:80&gt;
      ServerName test2
      DocumentRoot /home/user/www
      &lt;Directory /home/user/www&gt;
          Require all granted
      &lt;/Directory&gt;
  &lt;/VirtualHost&gt;
</code></pre>
<ul>
<li>Включите новый виртуальный хост:</li>
</ul>
<pre><code class="language-bash">  sudo a2ensite test2
</code></pre>
<ul>
<li>Дайте команду Apache HTTPd перечитать конфигурацию:</li>
</ul>
<pre><code class="language-bash">  sudo systemctl reload apache2
</code></pre>
<ul>
<li>
<p>Откройте в браузере хост-компьютера адреса http://test1 и http://test1 и убедитесь, что веб-сервер по-разному обслуживает два виртуальных хоста.</p>
</li>
<li>
<p>Добавьте в файл <code>/etc/apache2/sites-available/test2</code> внутрь тега <code>&lt;Directory&gt;</code> строку:</p>
</li>
</ul>
<pre><code>  Options Indexes
</code></pre>
<ul>
<li>
<p>Переименуйте файл <code>/home/user/www/index.php</code> в <code>index.php.bak</code>, перезагрузите конфигурацию Apache HTTPd и проверьте, что изменилось. Как измениться работа веб-сервера без опции <code>Indexes</code>?</p>
</li>
<li>
<p>Переименуйте файл <code>/home/user/www/index.php.bak</code> обратно в <code>index.php</code>.</p>
</li>
<li>
<p>Измените в файле <code>/etc/apache/ports.conf</code> номера основного портов с 80 на 8080. Внесите аналогичные изменения в файлах <code>default</code> и <code>test2</code> в каталоге <code>/etc/apache2/sites-available</code>.</p>
</li>
<li>
<p>Дайте команду Apache HTTPd перечитать конфигурацию:</p>
</li>
</ul>
<pre><code class="language-bash">  sudo systemctl reload apache2
</code></pre>
<h2>Установка веб-сервера Nginx</h2>
<ol>
<li>Установите необходимые пакеты с помощью команды:</li>
</ol>
<pre><code class="language-bash">  sudo apt-get install nginx php-fpm
</code></pre>
<ol start="2">
<li>
<p>Откройте в браузере хост-компьютера адреса http://test1, http://test1:8080 и http://test2:8080, убедитесь, что веб-серверы Apache HTTPd и Nginx работают.</p>
</li>
<li>
<p>Добавьте файл test2 в каталог <code>/etc/nginx/sites-available/</code>:</p>
</li>
</ol>
<pre><code>  server {
      listen 80;
      server_name test2;
      root /home/user/www;
      location / {
          index index.php;
      }
      location /t1 {
          proxy_pass http://test1:8080/;
      }
      location /t2 {
          proxy_pass http://test2:8080/;
      }
      location ~ \.php$ {
          include snippets/fastcgi-php.conf;
          fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;
      }
  }
</code></pre>
<ol>
<li>
<p>Создайте символическую ссылку на файл <code>/etc/nginx/sites-available/test2</code> в каталоге <code>/etc/nginx/sites-enabled</code> и перезапустите Nginx.</p>
</li>
<li>
<p>Откройте в браузере хост-компьютера страницы по адресам http://test1, http://test2, http://test2/t1 и http://test2/t2, убедитесь, что веб-серверы Apache HTTPd и Nginx работают вместе.</p>
</li>
</ol>
<h2>Литература</h2>
<ol>
<li>Кофлер М. Linux. Установка, настройка, администрирование</li>
<li>https://httpd.apache.org/docs/2.4/</li>
<li>https://nginx.org/ru/docs/</li>
</ol></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/linux/practice-01","query":{},"buildId":"LUG9vo4cHsjOtBLj04oqM","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>